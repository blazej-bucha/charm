
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PyHarm &#8212; CHarm 0.4.4-dev documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom_BB.css" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=59d1e446"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'cookbook-py';</script>
    <link rel="icon" href="_static/charm-logo.svg"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Interfaces" href="api.html" />
    <link rel="prev" title="CHarm" href="cookbook-c.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.4.4-dev" />
    <meta name="docbuild:last-update" content="Mar 17, 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/charm-logo.svg" class="logo__image only-light" alt=""/>
    <img src="_static/charm-logo.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">CHarm v0.4.4-dev</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="install.html">Installing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="install-pyharm-pip.html">Installation of PyHarm with pip</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="build-from-src.html">Building from source</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="build-from-src-unix.html">Unix-based operating systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-from-src-non-unix.html">Windows 10 and later</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="definitions.html">Some definitions to make things clear</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="cookbook.html">Cookbook</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cookbook-c.html">CHarm</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">PyHarm</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">Interfaces</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="api-c.html">CHarm (C API)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="api-c-shc.html">charm_shc</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-c-crd.html">charm_crd</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-c-shs.html">charm_shs</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-c-sha.html">charm_sha</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-c-gfm.html">charm_gfm</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-c-leg.html">charm_leg</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-c-integ.html">charm_integ</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-c-misc.html">charm_misc</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-c-err.html">charm_err</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-c-mpi.html">charm_mpi</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-c-glob.html">charm_glob</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-c-charm.html">charm</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="api-py.html">PyHarm (Python API)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="api-py-shc.html">pyharm.shc</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-py-crd.html">pyharm.crd</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-py-shs.html">pyharm.shs</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-py-sha.html">pyharm.sha</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-py-gfm.html">pyharm.gfm</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-py-leg.html">pyharm.leg</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-py-integ.html">pyharm.integ</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-py-misc.html">pyharm.misc</a></li>
<li class="toctree-l3"><a class="reference internal" href="api-py-glob.html">pyharm.glob</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="platforms.html">Tested platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/blazej-bucha/charm" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/blazej-bucha/charm/edit/master/docs/src/cookbook-py.rst" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/blazej-bucha/charm/issues/new?title=Issue%20on%20page%20%2Fcookbook-py.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/cookbook-py.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>PyHarm</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pyharm-in-double-precision">PyHarm in double precision</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integration-with-numpy">Integration with NumPy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-spherical-harmonic-coefficients">Working with spherical harmonic coefficients</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spherical-harmonic-synthesis-and-analysis">Spherical harmonic synthesis and analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#first-and-second-order-gradients-gravitational-vector-and-tensor">First- and second-order gradients (gravitational vector and tensor)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gravity-forward-modelling">Gravity forward modelling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fourier-coefficients-of-legendre-functions">Fourier coefficients of Legendre functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integrals">Integrals</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pyharm-in-single-precision">PyHarm in single precision</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="pyharm">
<span id="pyharm-cookbook"></span><h1>PyHarm<a class="headerlink" href="#pyharm" title="Link to this heading">#</a></h1>
<p>This chapter demonstrates how to perform some basic tasks with
PyHarm.  For a detailed description of the classes, methods, functions, etc. to
be used, see the <a class="reference internal" href="api-py.html#py-api"><span class="std std-ref">PyHarm (Python API)</span></a> chapter.  The source codes of the examples can
be found in the <code class="docutils literal notranslate"><span class="pre">cookbook/python</span></code> directory.</p>
<p>In your Python code, import PyHarm in double precision by:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyharm</span> <span class="k">as</span> <span class="nn">ph</span>
</pre></div>
</div>
<p>To import PyHarm in single precision, use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyharmf</span> <span class="k">as</span> <span class="nn">phf</span>
</pre></div>
</div>
<p>Both precisions can be combined in a single Python file, too:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyharm</span> <span class="k">as</span> <span class="nn">ph</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyharmf</span> <span class="k">as</span> <span class="nn">phf</span>
</pre></div>
</div>
<p>The chapters that follow show how to work with PyHarm in double and single
precision, respectively.  Quadruple precision is not supported in PyHarm.</p>
<section id="pyharm-in-double-precision">
<h2>PyHarm in double precision<a class="headerlink" href="#pyharm-in-double-precision" title="Link to this heading">#</a></h2>
<p>PyHarm attempts to follow the rules of the object-oriented programming
paradigm.  Several classes are introduced to represent spherical harmonic
coefficients, coordinates of evaluation points/cells and Fourier coefficients
of Legendre functions.  Most of the classes are accompanied by factory methods
for instantiation, so users should always instantiate the classes using these
methods.  The factory methods are summarized within the class documentation.
Alternatively, they can be found by searching for the <em>classmethod</em> flag that
precedes the class method names in the documentation.</p>
<section id="integration-with-numpy">
<h3>Integration with NumPy<a class="headerlink" href="#integration-with-numpy" title="Link to this heading">#</a></h3>
<p>PyHarm supports NumPy arrays.  All arrays consisting of floating point data
must</p>
<ul class="simple">
<li><p>be instances of the <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> class,</p></li>
<li><p>have the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> flag set to <code class="docutils literal notranslate"><span class="pre">numpy.float64</span></code> (or to <code class="docutils literal notranslate"><span class="pre">numpy.float32</span></code> if
the library was compiled in single precision), and</p></li>
<li><p>have the <code class="docutils literal notranslate"><span class="pre">flags.c_contiguous</span></code> attribute set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
</ul>
<p>As an example, letâ€™s create a 1D numpy array <code class="docutils literal notranslate"><span class="pre">x</span></code> that meets all of these
conditions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;float64&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">c_contiguous</span>
<span class="go">True</span>
</pre></div>
</div>
<p>In this code snippet, we did not specify the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> and <code class="docutils literal notranslate"><span class="pre">order</span></code> flags when
calling <code class="docutils literal notranslate"><span class="pre">numpy.zeros</span></code>,  so numpy automatically used their default values,
namely <code class="docutils literal notranslate"><span class="pre">numpy.float64</span></code> and <code class="docutils literal notranslate"><span class="pre">'C'</span></code>.  In some cases, you might need to
explicitly specify the two flags:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;float64&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">c_contiguous</span>
<span class="go">True</span>
</pre></div>
</div>
<p>For further details, see the <a class="reference external" href="https://numpy.org/">NumPy</a> documentation.</p>
<p>If an array passed to PyHarm does not meet all the required criteria, PyHarm
will throw an error.</p>
</section>
<section id="working-with-spherical-harmonic-coefficients">
<h3>Working with spherical harmonic coefficients<a class="headerlink" href="#working-with-spherical-harmonic-coefficients" title="Link to this heading">#</a></h3>
<p>This example shows how to read/write spherical harmonic coefficients from/to
files and how to compute (difference) degree variances.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyharm</span> <span class="k">as</span> <span class="nn">ph</span>


<span class="c1"># INPUTS</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># Define the path to an input &quot;gfc&quot; text file with spherical harmonic</span>
<span class="c1"># coefficients.  For details on the structure of the &quot;gfc&quot; file, see the</span>
<span class="c1"># documentation.</span>
<span class="n">shcs_in_file</span> <span class="o">=</span> <span class="s1">&#39;../../data/input/EGM96-degree10.gfc&#39;</span>


<span class="c1"># Maximum harmonic degree to read the spherical harmonic coefficients</span>
<span class="n">nmax</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>


<span class="c1"># Define the path to an output binary file with spherical harmonic</span>
<span class="c1"># coefficients.  For details on the structure of the output binary file, see</span>
<span class="c1"># the documentation of the &quot;shc&quot; module of &quot;CHarm&quot;.</span>
<span class="n">shcs_out_file</span> <span class="o">=</span> <span class="s1">&#39;../../data/output/EGM96-degree10.shcs&#39;</span>
<span class="c1"># =============================================================================</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># Read the spherical harmonic coefficients using the factory method &quot;from_file&quot;</span>
<span class="c1"># of the &quot;Shc&quot; class from the &quot;ph.shc&quot; module.</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="n">shcs</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shc</span><span class="o">.</span><span class="n">Shc</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;gfc&#39;</span><span class="p">,</span> <span class="n">shcs_in_file</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>


<span class="c1"># Now print some more or less randomly chosen spherical harmonic coefficients</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Let&#39;s start with zonal coefficients</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">cnm</span><span class="p">,</span> <span class="n">snm</span> <span class="o">=</span> <span class="n">shcs</span><span class="o">.</span><span class="n">get_coeffs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;C(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">) = </span><span class="si">{</span><span class="n">cnm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;S(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">) = </span><span class="si">{</span><span class="n">snm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="c1"># Now some tesseral coefficients</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">cnm</span><span class="p">,</span> <span class="n">snm</span> <span class="o">=</span> <span class="n">shcs</span><span class="o">.</span><span class="n">get_coeffs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;C(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">) = </span><span class="si">{</span><span class="n">cnm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;S(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">) = </span><span class="si">{</span><span class="n">snm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="c1"># And finally some sectorial coefficients</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">cnm</span><span class="p">,</span> <span class="n">snm</span> <span class="o">=</span> <span class="n">shcs</span><span class="o">.</span><span class="n">get_coeffs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;C(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">) = </span><span class="si">{</span><span class="n">cnm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;S(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">) = </span><span class="si">{</span><span class="n">snm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>


<span class="c1"># Now let&#39;s save the coefficients to a binary file and then read them back to</span>
<span class="c1"># a new &quot;Shc&quot; class instance.  Just for the fun...</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="n">shcs</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="n">nmax</span><span class="p">,</span> <span class="n">shcs_out_file</span><span class="p">)</span>


<span class="c1"># Read back the coefficients to a new class instance called &quot;shcs2&quot;</span>
<span class="n">shcs2</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shc</span><span class="o">.</span><span class="n">Shc</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="n">shcs_out_file</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>


<span class="c1"># Compute degree variances from &quot;shcs&quot;</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="n">dv</span> <span class="o">=</span> <span class="n">shcs</span><span class="o">.</span><span class="n">dv</span><span class="p">()</span>


<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Degree variance for harmonic degree </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">dv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">4</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Degree variance for harmonic degree </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">dv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Degree variance for harmonic degree </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">dv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>


<span class="c1"># Now check whether &quot;shcs&quot; and &quot;shcs2&quot; contain the same coefficients by</span>
<span class="c1"># computing difference degree variances</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="n">ddv</span> <span class="o">=</span> <span class="n">shcs</span><span class="o">.</span><span class="n">ddv</span><span class="p">(</span><span class="n">shcs2</span><span class="p">)</span>


<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Difference degree variance for harmonic degree </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">ddv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">4</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Difference degree variance for harmonic degree </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">ddv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Difference degree variance for harmonic degree </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">ddv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Great, all done!&#39;</span><span class="p">)</span>
<span class="c1"># =============================================================================</span>
</pre></div>
</div>
</section>
<section id="spherical-harmonic-synthesis-and-analysis">
<h3>Spherical harmonic synthesis and analysis<a class="headerlink" href="#spherical-harmonic-synthesis-and-analysis" title="Link to this heading">#</a></h3>
<p>This section shows several examples.</p>
<ul class="simple">
<li><p>A closed-loop test of analysis and synthesis with point data values.  First,
spherical harmonic coefficients are loaded from a text file.  Then, they are
used to synthesize a signal, from which a new set of coefficients is finally
computed by surface spherical harmonic analysis.  The two coefficients sets
are then finally compared (should be equal, that is, the difference degree
amplitudes should be negligibly small).</p></li>
<li><p>A solid spherical harmonic synthesis of point values at scattered points.</p></li>
<li><p>A solid spherical harmonic synthesis of point values at a custom grid of
points.</p></li>
<li><p>A solid spherical harmonic synthesis of block-mean values at scattered cells.</p></li>
<li><p>A solid spherical harmonic synthesis of block mean values at a grid of cells.</p></li>
<li><p>Surface spherical harmonic analysis with block-mean values in cells.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyharm</span> <span class="k">as</span> <span class="nn">ph</span>


<span class="c1"># INPUTS</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># Define the path to an input text file with spherical harmonic coefficients.</span>
<span class="c1"># For details on the structure of the text file, see the documentation.</span>
<span class="n">shcs_in_file</span> <span class="o">=</span> <span class="s1">&#39;../../data/input/EGM96-degree10-mtx.txt&#39;</span>


<span class="c1"># Maximum harmonic degree of coefficients to read.  The same degree is used</span>
<span class="c1"># later in the harmonic synthesis and harmonic analysis.</span>
<span class="n">nmax</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># =============================================================================</span>


<span class="c1"># =============================================================================</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Closed-loop experiment -- Spherical harmonic synthesis and analysis&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===========================&#39;</span><span class="p">)</span>


<span class="c1"># Read spherical harmonic coefficients from the input text file.</span>
<span class="n">shcs</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shc</span><span class="o">.</span><span class="n">Shc</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;mtx&#39;</span><span class="p">,</span> <span class="n">shcs_in_file</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>


<span class="c1"># Now let&#39;s say we do not want to use the zero-degree term.  This can be</span>
<span class="c1"># achieved simply by setting the respective &quot;C00&quot; coefficient to zero.</span>
<span class="n">shcs</span><span class="o">.</span><span class="n">set_coeffs</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>


<span class="c1"># Compute the Gauss--Legendre grid for a given &quot;nmax&quot; on a sphere that is</span>
<span class="c1"># &quot;1000.0&quot; metres above the reference sphere of spherical harmonic</span>
<span class="c1"># coefficients.  PyHarm represents the Gauss--Legendre grid via the</span>
<span class="c1"># &quot;PointGridGL&quot; class.  For the Driscoll--Healy grids, PyHarm has the</span>
<span class="c1"># &quot;PointGridDH1&quot; and &quot;PointGridDH2&quot; classes (see the documentation).</span>
<span class="n">grd_pnt</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">crd</span><span class="o">.</span><span class="n">PointGridGL</span><span class="p">(</span><span class="n">nmax</span><span class="p">,</span> <span class="n">shcs</span><span class="o">.</span><span class="n">r</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>


<span class="c1"># Perform the synthesis.  Since the Gauss--Legendre grid resides &quot;1000.0&quot;</span>
<span class="c1"># metres above the reference sphere of the coefficients, performed is</span>
<span class="c1"># solid spherical harmonic synthesis.</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shs</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="n">grd_pnt</span><span class="p">,</span> <span class="n">shcs</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>


<span class="c1"># Note on parallelization</span>
<span class="c1"># -----------------------</span>
<span class="c1">#</span>
<span class="c1"># If you compiled the library with OpenMP parallelization enabled, you can</span>
<span class="c1"># control the number of threads being used either by an environmental variable</span>
<span class="c1"># or in your Python code, for instance, like this:</span>
<span class="c1">#</span>
<span class="c1"># from threadpoolctl import threadpool_limits</span>
<span class="c1"># with threadpool_limits(limits=2):</span>
<span class="c1">#     f = ph.shs.point(grd_pnt, shcs, nmax)</span>


<span class="c1"># Print some synthesized values</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Print some synthesized values of the signal...&#39;</span><span class="p">)</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;f(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">) = </span><span class="si">{</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="n">i</span> <span class="o">=</span> <span class="n">grd_pnt</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">grd_pnt</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;f(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">) = </span><span class="si">{</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>


<span class="c1"># Now use the synthesized signal and compute back its spherical harmonic</span>
<span class="c1"># coefficients by harmonic analysis.  The output coefficients in &quot;shcs2&quot; should</span>
<span class="c1"># be the same as the input ones in &quot;shcs&quot;.  Note that the signal &quot;f&quot; resides on</span>
<span class="c1"># a sphere that is &quot;1000.0&quot; metres above the reference sphere &quot;shcs.r&quot;.  The</span>
<span class="c1"># last input parameter therefore allows user to define the reference radius of</span>
<span class="c1"># the output coefficients.  In this case, this value is set to &quot;shcs.r&quot; to</span>
<span class="c1"># ensure that &quot;shcs2.r&quot; will be the same as &quot;shcs.r&quot;.</span>
<span class="n">shcs2</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">sha</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="n">grd_pnt</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">nmax</span><span class="p">,</span> <span class="n">shcs</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">shcs</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>


<span class="c1"># Now check whether &quot;shcs&quot; and &quot;shcs2&quot; are the same by computing their</span>
<span class="c1"># difference degree amplitudes</span>
<span class="n">dda</span> <span class="o">=</span> <span class="n">shcs</span><span class="o">.</span><span class="n">dda</span><span class="p">(</span><span class="n">shcs2</span><span class="p">)</span>


<span class="c1"># Print some difference degree amplitudes</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Now print the difference degree amplitudes.  These should be&#39;</span>
      <span class="s1">&#39;very small, say, at the order of 1e-18 or less...&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Difference degree amplitude for harmonic degree </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">dda</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">4</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Difference degree amplitude for harmonic degree </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">dda</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Difference degree amplitude for harmonic degree </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">dda</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="c1"># We will not need some of the variables anymore, so let&#39;s free the memory by</span>
<span class="c1"># deleting them</span>
<span class="k">del</span> <span class="n">grd_pnt</span><span class="p">,</span> <span class="n">shcs2</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">dda</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===========================&#39;</span><span class="p">)</span>
<span class="c1"># =============================================================================</span>


<span class="c1"># =============================================================================</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solid spherical harmonic synthesis at scattered points&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===========================&#39;</span><span class="p">)</span>


<span class="c1"># Create a &quot;PointSctr&quot; class instance to store three scattered points.  The</span>
<span class="c1"># instance will be created from three numpy arrays that hold the coordinates of</span>
<span class="c1"># the scattered points.</span>
<span class="n">lat</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.436231</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9651</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">lon</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.53434</span><span class="p">,</span> <span class="mf">4.2316</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">r</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">2000.0</span><span class="p">,</span> <span class="mf">3000.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">+</span> <span class="n">shcs</span><span class="o">.</span><span class="n">r</span>
<span class="n">sctr_pnt</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">crd</span><span class="o">.</span><span class="n">PointSctr</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>


<span class="c1"># Do the synthesis</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shs</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="n">sctr_pnt</span><span class="p">,</span> <span class="n">shcs</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>


<span class="c1"># It&#39;s really this easy!</span>


<span class="c1"># Print the synthesized values</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="k">del</span> <span class="n">sctr_pnt</span><span class="p">,</span> <span class="n">f</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===========================&#39;</span><span class="p">)</span>
<span class="c1"># =============================================================================</span>


<span class="c1"># =============================================================================</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solid spherical harmonic synthesis at a custom grid of points&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===========================&#39;</span><span class="p">)</span>

<span class="c1"># Define some grid points as numpy arrays.  Then create a &quot;PointGrid&quot; class</span>
<span class="c1"># instance that is designed to store custom point grids.</span>
<span class="n">nlat</span>    <span class="o">=</span> <span class="mi">5</span>
<span class="n">nlon</span>    <span class="o">=</span> <span class="mi">10</span>
<span class="n">lat</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">nlat</span><span class="p">)</span>
<span class="n">lon</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">nlon</span><span class="p">)</span>
<span class="n">r</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nlat</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">+</span> <span class="n">shcs</span><span class="o">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlat</span><span class="p">)</span>
<span class="n">grd_pnt</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">crd</span><span class="o">.</span><span class="n">PointGrid</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>


<span class="c1"># Do the synthesis</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shs</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="n">grd_pnt</span><span class="p">,</span> <span class="n">shcs</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>


<span class="c1"># Print the synthesized values</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="k">del</span> <span class="n">grd_pnt</span><span class="p">,</span> <span class="n">f</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===========================&#39;</span><span class="p">)</span>
<span class="c1"># =============================================================================</span>


<span class="c1"># =============================================================================</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solid spherical harmonic synthesis at scattered cells&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===========================&#39;</span><span class="p">)</span>


<span class="c1"># Now we define evaluation cells to synthesize area mean values.  To this end,</span>
<span class="c1"># we specify numpy arrays of minimum and maximum latitudes and longitudes and</span>
<span class="c1"># an array of spherical radii.  Using these arrays, we create a &quot;CellSctr&quot;</span>
<span class="c1"># class instance.</span>
<span class="n">latmax</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.323413435</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.90234320952</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="n">latmin</span>    <span class="o">=</span> <span class="n">latmax</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.234323</span><span class="p">,</span> <span class="mf">0.4456</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="n">lonmin</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.123456789</span><span class="p">,</span> <span class="mf">4.3445234</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="n">lonmax</span>    <span class="o">=</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.3235</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
<span class="n">r</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">latmin</span><span class="o">.</span><span class="n">size</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">+</span> <span class="n">shcs</span><span class="o">.</span><span class="n">r</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">latmax</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1000.0</span>
<span class="n">cell_sctr</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">crd</span><span class="o">.</span><span class="n">CellSctr</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">latmin</span><span class="p">,</span> <span class="n">latmax</span><span class="p">,</span> <span class="n">lonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>


<span class="c1"># Do the synthesis</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shs</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">cell_sctr</span><span class="p">,</span> <span class="n">shcs</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>


<span class="c1"># Print the synthesized values</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="k">del</span> <span class="n">cell_sctr</span><span class="p">,</span> <span class="n">f</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===========================&#39;</span><span class="p">)</span>
<span class="c1"># =============================================================================</span>


<span class="c1"># =============================================================================</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solid spherical harmonic synthesis at a grid of cells&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===========================&#39;</span><span class="p">)</span>


<span class="c1"># Define the grid cells and create a &quot;CellGrid&quot; class instance from numpy</span>
<span class="c1"># arrays.</span>
<span class="n">nlat</span>     <span class="o">=</span> <span class="mi">15</span>
<span class="n">nlon</span>     <span class="o">=</span> <span class="mi">30</span>
<span class="n">latmax</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">nlat</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">latmin</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">latmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">nlat</span><span class="p">)</span>
<span class="n">lonmin</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">nlon</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">lonmax</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lonmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">nlon</span><span class="p">)</span>
<span class="n">r</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nlat</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">+</span> <span class="n">shcs</span><span class="o">.</span><span class="n">r</span>
<span class="n">grd_cell</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">crd</span><span class="o">.</span><span class="n">CellGrid</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">latmin</span><span class="p">,</span> <span class="n">latmax</span><span class="p">,</span> <span class="n">lonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>


<span class="c1"># Do the synthesis</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shs</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">grd_cell</span><span class="p">,</span> <span class="n">shcs</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>


<span class="c1"># Print some of the synthesized values</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">j</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;f(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">) = </span><span class="si">{</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="n">i</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">j</span> <span class="o">=</span> <span class="mi">3</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;f(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">) = </span><span class="si">{</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===========================&#39;</span><span class="p">)</span>
<span class="c1"># =============================================================================</span>


<span class="c1"># =============================================================================</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Spherical harmonic analysis of block-mean values in cells&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===========================&#39;</span><span class="p">)</span>


<span class="c1"># In this example, we use the &quot;grd_cell&quot; instance and the signal &quot;f&quot; from the</span>
<span class="c1"># previous example</span>


<span class="c1"># Do the analysis using the approximate quadrature</span>
<span class="n">shcs2</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">sha</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="n">grd_cell</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">nmax</span><span class="p">,</span> <span class="n">ph</span><span class="o">.</span><span class="n">sha</span><span class="o">.</span><span class="n">CELL_AQ</span><span class="p">,</span> <span class="n">shcs</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">shcs</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>


<span class="c1"># Print some of the computed coefficients.  Note that the harmonic analysis</span>
<span class="c1"># with block-mean values in cells is *not* exact, hence the coefficients will</span>
<span class="c1"># not be equal to the input ones.</span>
<span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>  <span class="c1"># List of harmonic degrees</span>
<span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>  <span class="c1"># List of harmonic orders</span>
<span class="n">cnm</span><span class="p">,</span> <span class="n">snm</span> <span class="o">=</span> <span class="n">shcs2</span><span class="o">.</span><span class="n">get_coeffs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">m1</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;C(</span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">m1</span><span class="si">}</span><span class="s1">) = </span><span class="si">{</span><span class="n">cnm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;S(</span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">m1</span><span class="si">}</span><span class="s1">) = </span><span class="si">{</span><span class="n">snm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="k">del</span> <span class="n">grd_cell</span><span class="p">,</span> <span class="n">shcs2</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">shcs</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;===========================&#39;</span><span class="p">)</span>
<span class="c1"># =============================================================================</span>
</pre></div>
</div>
</section>
<section id="first-and-second-order-gradients-gravitational-vector-and-tensor">
<h3>First- and second-order gradients (gravitational vector and tensor)<a class="headerlink" href="#first-and-second-order-gradients-gravitational-vector-and-tensor" title="Link to this heading">#</a></h3>
<p>This example shows how to compute the full gravitational vector and the full
gravitational tensor in the <a class="reference internal" href="definitions.html#lnof"><span class="std std-ref">Local north-oriented reference frame</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyharm</span> <span class="k">as</span> <span class="nn">ph</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="c1"># INPUTS</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># Path to the input file with spherical harmonic coefficients in the &#39;gfc&#39;</span>
<span class="c1"># format</span>
<span class="n">shcs_file</span> <span class="o">=</span> <span class="s1">&#39;../../data/input/EGM96-degree10.gfc&#39;</span>
<span class="c1"># =============================================================================</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># First, let&#39;s get the maximum harmonic degree stored in &quot;shcs_file&quot;.  This is</span>
<span class="c1"># especially useful to read all coefficients in &quot;shcs_file&quot; without knowing its</span>
<span class="c1"># maximum harmonic degree a priori.</span>
<span class="n">nmax</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shc</span><span class="o">.</span><span class="n">Shc</span><span class="o">.</span><span class="n">nmax_from_file</span><span class="p">(</span><span class="s1">&#39;gfc&#39;</span><span class="p">,</span> <span class="n">shcs_file</span><span class="p">)</span>


<span class="c1"># Now read all coefficients in &quot;shcs_file&quot;</span>
<span class="n">shcs</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shc</span><span class="o">.</span><span class="n">Shc</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;gfc&#39;</span><span class="p">,</span> <span class="n">shcs_file</span><span class="p">,</span> <span class="n">nmax</span><span class="p">)</span>


<span class="c1"># Compute the Gauss--Legendre point grid for an &quot;nmax&quot; given by the maximum</span>
<span class="c1"># degree stored in &quot;shcs&quot; and for a radius equal to the reference sphere,</span>
<span class="c1"># to which the spherical harmonic coefficients are scaled to.  We intentionally</span>
<span class="c1"># use here the Gauss--Legendre grid instead of the Driscoll--Healy grids in</span>
<span class="c1"># order to avoid the inaccuracies due to the singularities at the poles (see</span>
<span class="c1"># the documentation).</span>
<span class="n">grd</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">crd</span><span class="o">.</span><span class="n">PointGridGL</span><span class="p">(</span><span class="n">shcs</span><span class="o">.</span><span class="n">nmax</span><span class="p">,</span> <span class="n">shcs</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>


<span class="c1"># Compute the full first-order gradient (vector)</span>
<span class="n">fx</span><span class="p">,</span> <span class="n">fy</span><span class="p">,</span> <span class="n">fz</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shs</span><span class="o">.</span><span class="n">point_grad1</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">shcs</span><span class="p">,</span> <span class="n">shcs</span><span class="o">.</span><span class="n">nmax</span><span class="p">)</span>


<span class="c1"># Compute the magnitude of the gravitational acceleration (no contribution due</span>
<span class="c1"># to the centrifugal force is considered here)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">fy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">fz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>


<span class="c1"># Now compute the full second-order gradient (tensor)</span>
<span class="n">fxx</span><span class="p">,</span> <span class="n">fxy</span><span class="p">,</span> <span class="n">fxz</span><span class="p">,</span> <span class="n">fyy</span><span class="p">,</span> <span class="n">fyz</span><span class="p">,</span> <span class="n">fzz</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shs</span><span class="o">.</span><span class="n">point_grad2</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">shcs</span><span class="p">,</span> <span class="n">shcs</span><span class="o">.</span><span class="n">nmax</span><span class="p">)</span>


<span class="c1"># Check whether &quot;fxx + fyy + fzz&quot; is zero within numerical errors</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The largest error of the gravitational tensor trace is &#39;</span>
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fxx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fyy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fzz</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s1"> s**-2&#39;</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Great, all done!&#39;</span><span class="p">)</span>
<span class="c1"># =============================================================================</span>
</pre></div>
</div>
</section>
<section id="gravity-forward-modelling">
<h3>Gravity forward modelling<a class="headerlink" href="#gravity-forward-modelling" title="Link to this heading">#</a></h3>
<p>Given spherical harmonic coefficients of the Moonâ€™s topography and of its
density (constant, lateral and 3D density), this example computes the
gravitational field implied by the lunar topographic masses.</p>
<p>The lunar shape is here defined by the <code class="docutils literal notranslate"><span class="pre">MoonTopo2600p.shape</span></code> model due to</p>
<blockquote>
<div><ul class="simple">
<li><p>Wieczorek, M. A., Gravity and topography of the terrestrial planets,
Treatise on Geophysics, 10, 153-193, doi:10.1016/B978-0-444-53802-4.00169-X,
2015.</p></li>
</ul>
</div></blockquote>
<p>The density model is due to</p>
<blockquote>
<div><ul class="simple">
<li><p>Goossens, S., Sabaka, T.J., Wieczorek, M.A., Neumann, G.A., Mazarico, E.,
Lemoine, F., Nicholas, J.B., Smith, D.E., Zuber,
M.T. (2020). High-resolution gravity field models from GRAIL data and
implications for models of the density structure of the Moonâ€™s crust,
Journal of Geophysical Research: Planets, 125, e2019JE006086,
doi:10.1029/2019JE006086.</p></li>
</ul>
</div></blockquote>
<p>The density model of Goossens et al. (2020) was transformed into the form
required by our forward modelling method.  While the transformed models that we
use in this example are realistic, it is not recommended to use them in any
real task.  They were create for learning purposes only.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># IMPORTANT: To run this program, CHarm must be compiled with the MPFR</span>
<span class="c1"># support, that is, using the &quot;--with-mpfr&quot; installation flag.  If this is your</span>
<span class="c1"># case, manually delete (or comment out) all lines between the following</span>
<span class="c1"># marks:</span>
<span class="c1">#</span>
<span class="c1"># @@@</span>
<span class="c1">#</span>
<span class="c1"># lines to be deleted or commented out</span>
<span class="c1">#</span>
<span class="c1"># !!!</span>


<span class="kn">import</span> <span class="nn">pyharm</span> <span class="k">as</span> <span class="nn">ph</span>


<span class="c1"># INPUTS</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># Shape of the gravitating body</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Upper integration limit in spherical radius (topography)</span>
<span class="c1"># .............................................................................</span>
<span class="c1"># Path to spherical harmonic coefficients defining the shape of the Moon</span>
<span class="n">path_shcs_shape</span> <span class="o">=</span> <span class="s1">&#39;../../data/input/MoonTopo2600p_to10-tbl.txt&#39;</span>


<span class="c1"># Maximum harmonic degree of the lunar topography defined by coefficients in</span>
<span class="c1"># &quot;path_shcs_shape&quot;</span>
<span class="n">shape_nmax</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># .............................................................................</span>


<span class="c1"># Lower integration limit in spherical radius (sphere)</span>
<span class="c1"># .............................................................................</span>
<span class="c1"># Radius of the reference sphere</span>
<span class="n">rref</span> <span class="o">=</span> <span class="mf">1728000.0</span>
<span class="c1"># .............................................................................</span>
<span class="c1"># -----------------------------------------------------------------------------</span>


<span class="c1"># Density of the gravitating body</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Path to spherical harmonic coefficients defining the zero- and first-order</span>
<span class="c1"># polynomial density coefficients */</span>
<span class="n">path_shcs_density</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;../../data/input/moon-rho0_to10.tbl&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;../../data/input/moon-rho1_to10.tbl&#39;</span><span class="p">]</span>


<span class="c1"># Maximum harmonic degrees of the polynomial density coefficients in</span>
<span class="c1"># &quot;path_shcs_density&quot;.</span>
<span class="n">density_nmax</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>


<span class="c1"># Order of the density polynomial</span>
<span class="n">density_order</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">path_shcs_density</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="c1"># -----------------------------------------------------------------------------</span>


<span class="c1"># Other inputs</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Newton&#39;s gravitational constant (&quot;kg**-1 * m**3 * s**-2&quot;)</span>
<span class="n">gc</span> <span class="o">=</span> <span class="mf">6.67430e-11</span>


<span class="c1"># Mass of the Moon (&quot;kg&quot;)</span>
<span class="n">mass</span> <span class="o">=</span> <span class="mf">7.346e22</span>


<span class="c1"># Minimum and maximum topography powers.  In theory, &quot;pmax&quot; should be</span>
<span class="c1"># infinitely large, so higher &quot;pmax&quot; means more complete forward modelling (but</span>
<span class="c1"># also longer computation times).</span>
<span class="n">pmin</span><span class="p">,</span> <span class="n">pmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span>


<span class="c1"># Maximum harmonic degree of the output gravitational potential.  Due to the</span>
<span class="c1"># non-linear relation between topography and its implied gravitational field,</span>
<span class="c1"># the potential series is spectrally unlimited even if &quot;shape_nmax&quot; is finite</span>
<span class="c1"># (the only exception is &quot;shape_nmax = 0&quot;).  Therefore, this value should be as</span>
<span class="c1"># high as reasonably possible in order to mitigate forward modelling errors.</span>
<span class="n">nmax_potential</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># =============================================================================</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># Read the shape coefficients</span>
<span class="n">shape_shcs</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shc</span><span class="o">.</span><span class="n">Shc</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;tbl&#39;</span><span class="p">,</span> <span class="n">path_shcs_shape</span><span class="p">,</span> <span class="n">shape_nmax</span><span class="p">)</span>


<span class="c1"># Read the density coefficients</span>
<span class="n">density_shcs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">density_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">density_order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">density_shcs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shc</span><span class="o">.</span><span class="n">Shc</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;tbl&#39;</span><span class="p">,</span> <span class="n">path_shcs_density</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                           <span class="n">density_nmax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>


<span class="c1"># Global gravity forward modelling using 3D density</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="n">potential_global_shcs</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">gfm</span><span class="o">.</span><span class="n">global_density_3d</span><span class="p">(</span><span class="n">shape_shcs</span><span class="p">,</span> <span class="n">shape_nmax</span><span class="p">,</span> <span class="n">rref</span><span class="p">,</span>
                                                 <span class="n">density_shcs</span><span class="p">,</span> <span class="n">density_nmax</span><span class="p">,</span>
                                                 <span class="n">density_order</span><span class="p">,</span>
                                                 <span class="n">gc</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span>
                                                 <span class="n">pmin</span><span class="p">,</span> <span class="n">pmax</span><span class="p">,</span>
                                                 <span class="n">nmax_potential</span><span class="p">,</span>
                                                 <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


<span class="c1"># Now we can compute, say, the gravitational potential using</span>
<span class="c1"># &quot;potential_global_shcs&quot;.  Let&#39;s do this in the Gauss--Legendre grid that</span>
<span class="c1"># passes above all lunar masses.</span>
<span class="n">grd</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">crd</span><span class="o">.</span><span class="n">PointGridGL</span><span class="p">(</span><span class="n">potential_global_shcs</span><span class="o">.</span><span class="n">nmax</span><span class="p">,</span>
                         <span class="n">potential_global_shcs</span><span class="o">.</span><span class="n">r</span> <span class="o">+</span> <span class="mf">25000.0</span><span class="p">)</span>
<span class="n">vgfm</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shs</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">potential_global_shcs</span><span class="p">,</span> <span class="n">potential_global_shcs</span><span class="o">.</span><span class="n">nmax</span><span class="p">)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>


<span class="c1"># In CHarm, gravity forward modelling using lateral density is fairly similar</span>
<span class="c1"># to using 3D density, so we skip it. */</span>


<span class="c1"># Global gravity forward modelling using constant density</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Constant density of the lunar crust</span>
<span class="n">density_const</span> <span class="o">=</span> <span class="mf">2550.0</span>


<span class="n">potential_global_shcs</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">gfm</span><span class="o">.</span><span class="n">global_density_const</span><span class="p">(</span><span class="n">shape_shcs</span><span class="p">,</span> <span class="n">shape_nmax</span><span class="p">,</span>
                                                    <span class="n">rref</span><span class="p">,</span>
                                                    <span class="n">density_const</span><span class="p">,</span>
                                                    <span class="n">gc</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span>
                                                    <span class="n">pmin</span><span class="p">,</span> <span class="n">pmax</span><span class="p">,</span>
                                                    <span class="n">nmax_potential</span><span class="p">)</span>


<span class="c1"># You could now similarly synthesize the gravitational potential, this time</span>
<span class="c1"># being implied by the constant density model</span>
<span class="c1"># -----------------------------------------------------------------------------</span>


<span class="c1"># @@@</span>
<span class="c1"># Spatially restricted gravity forward modelling of near-zone masses using 3D</span>
<span class="c1"># density</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Minimum and maximum order of the radial derivatives of the output quantity</span>
<span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>


<span class="c1"># Radius of the sphere, on which evaluation points reside</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">rref</span> <span class="o">+</span> <span class="mf">25000.0</span>


<span class="c1"># Integration radius in radians</span>
<span class="n">psi0</span> <span class="o">=</span> <span class="mf">0.2</span>


<span class="c1"># Order of the potential derivative (&quot;0&quot; for potential, &quot;1&quot; for quantities</span>
<span class="c1"># related to gravitational vector elements, and &quot;2&quot; for quantities related</span>
<span class="c1"># to gravitational tensor elements)</span>
<span class="n">u</span> <span class="o">=</span> <span class="mi">0</span>


<span class="c1"># Order of the potential derivative with respect to the spherical distance</span>
<span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>


<span class="c1"># We want to integrate all masses up to distance &quot;psi0&quot; from evalution</span>
<span class="c1"># points.  To integrate masses beyond &quot;psi0&quot;, set &quot;zone&quot; to</span>
<span class="c1"># &quot;ph.gfm.FAR_ZOZE&quot;. */</span>
<span class="n">zone</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">gfm</span><span class="o">.</span><span class="n">NEAR_ZONE</span>


<span class="c1"># Number of bits to represent significands of floating points numbers used to</span>
<span class="c1"># evaluate</span>
<span class="c1"># truncation coefficients</span>
<span class="n">nbits</span> <span class="o">=</span> <span class="mi">512</span>


<span class="n">potential_cap_shcs</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">gfm</span><span class="o">.</span><span class="n">cap_density_3d</span><span class="p">(</span><span class="n">shape_shcs</span><span class="p">,</span> <span class="n">shape_nmax</span><span class="p">,</span> <span class="n">rref</span><span class="p">,</span>
                                           <span class="n">density_shcs</span><span class="p">,</span> <span class="n">density_nmax</span><span class="p">,</span>
                                           <span class="n">density_order</span><span class="p">,</span>
                                           <span class="n">gc</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span>
                                           <span class="n">pmin</span><span class="p">,</span> <span class="n">pmax</span><span class="p">,</span>
                                           <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span>
                                           <span class="n">r</span><span class="p">,</span>
                                           <span class="n">psi0</span><span class="p">,</span>
                                           <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span>
                                           <span class="n">zone</span><span class="p">,</span>
                                           <span class="n">nbits</span><span class="p">,</span>
                                           <span class="n">nmax_potential</span><span class="p">)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>


<span class="c1"># Spatially restricted gravity forward modelling of near-zone masses using</span>
<span class="c1"># constant density</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="n">potential_cap_shcs</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">gfm</span><span class="o">.</span><span class="n">cap_density_const</span><span class="p">(</span><span class="n">shape_shcs</span><span class="p">,</span> <span class="n">shape_nmax</span><span class="p">,</span> <span class="n">rref</span><span class="p">,</span>
                                              <span class="n">density_const</span><span class="p">,</span>
                                              <span class="n">gc</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span>
                                              <span class="n">pmin</span><span class="p">,</span> <span class="n">pmax</span><span class="p">,</span>
                                              <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span>
                                              <span class="n">r</span><span class="p">,</span>
                                              <span class="n">psi0</span><span class="p">,</span>
                                              <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span>
                                              <span class="n">zone</span><span class="p">,</span>
                                              <span class="n">nbits</span><span class="p">,</span>
                                              <span class="n">nmax_potential</span><span class="p">)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>


<span class="c1"># Let&#39;s compute some Molodensky&#39;s truncation coefficients, which are used</span>
<span class="c1"># internally whenever calling the &quot;charm_gfm_cap_density_*&quot; routines.</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">gfm</span><span class="o">.</span><span class="n">cap_q</span><span class="p">(</span><span class="n">rref</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">nmax_potential</span><span class="p">,</span> <span class="n">pmax</span><span class="p">,</span> <span class="n">kmin</span><span class="p">,</span> <span class="n">kmax</span><span class="p">,</span>
                 <span class="n">density_order</span><span class="p">,</span> <span class="n">ph</span><span class="o">.</span><span class="n">gfm</span><span class="o">.</span><span class="n">NEAR_ZONE</span><span class="p">,</span> <span class="n">ph</span><span class="o">.</span><span class="n">gfm</span><span class="o">.</span><span class="n">Q00</span><span class="p">,</span> <span class="n">nbits</span><span class="p">)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># !!!</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Great, all done!&#39;</span><span class="p">)</span>
<span class="c1"># =============================================================================</span>
</pre></div>
</div>
</section>
<section id="fourier-coefficients-of-legendre-functions">
<h3>Fourier coefficients of Legendre functions<a class="headerlink" href="#fourier-coefficients-of-legendre-functions" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyharm</span> <span class="k">as</span> <span class="nn">ph</span>


<span class="c1"># Maximum harmonic degree to compute the Fourier coefficients of Legendre</span>
<span class="c1"># functions</span>
<span class="n">nmax</span> <span class="o">=</span> <span class="mi">500</span>


<span class="c1"># Create a &quot;ph.leg.Pnmj&quot; class instance using the factory method called</span>
<span class="c1"># &quot;from_zeros&quot;</span>
<span class="n">pnmj</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">leg</span><span class="o">.</span><span class="n">Pnmj</span><span class="o">.</span><span class="n">from_zeros</span><span class="p">(</span><span class="n">nmax</span><span class="p">,</span> <span class="n">ph</span><span class="o">.</span><span class="n">leg</span><span class="o">.</span><span class="n">PMNJ</span><span class="p">)</span>


<span class="c1"># Compute the Fourier coefficients</span>
<span class="n">pnmj</span><span class="o">.</span><span class="n">coeffs</span><span class="p">()</span>


<span class="c1"># Print some Fourier coefficients</span>
<span class="c1"># Harmonic degree</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">123</span>
<span class="c1"># Harmonic order</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">23</span>
<span class="c1"># Wave-number-related variable</span>
<span class="n">j</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">pnmj</span><span class="o">.</span><span class="n">j2k</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">pnmj</span><span class="o">.</span><span class="n">get_coeff</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Fourier coefficients for degree </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, order </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1"> and wave-number </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> = &#39;</span>
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="n">n</span> <span class="o">=</span> <span class="mi">360</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">358</span>
<span class="n">j</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">pnmj</span><span class="o">.</span><span class="n">j2k</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">pnmj</span><span class="o">.</span><span class="n">get_coeff</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Fourier coefficients for degree </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">, order </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1"> and wave-number </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> = &#39;</span>
      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Great, all done!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="integrals">
<h3>Integrals<a class="headerlink" href="#integrals" title="Link to this heading">#</a></h3>
<p>Finally, letâ€™s compute an integral of a product of two spherical harmonics over
a restricted domain on the unit sphere.  Then, we do the same, but with the
product of Legendre functions only.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyharm</span> <span class="k">as</span> <span class="nn">ph</span>


<span class="c1"># Type of the first spherical harmonic function, its harmonic degree and order,</span>
<span class="c1"># respectively</span>
<span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">n1</span> <span class="o">=</span> <span class="mi">287</span>
<span class="n">m1</span> <span class="o">=</span> <span class="mi">122</span>


<span class="c1"># Type of the second spherical harmonic function, its harmonic degree and</span>
<span class="c1"># order, respectively</span>
<span class="n">i2</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">n2</span> <span class="o">=</span> <span class="mi">34</span>
<span class="n">m2</span> <span class="o">=</span> <span class="mi">9</span>


<span class="c1"># Minimum and maximum co-latitudes of the integration domain</span>
<span class="n">cltmin</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">cltmax</span> <span class="o">=</span> <span class="mf">0.9</span>


<span class="c1"># Minimum and maximum longitudes of the intration domain</span>
<span class="n">lonmin</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">lonmax</span> <span class="o">=</span> <span class="mf">0.6</span>


<span class="c1"># Compute the Fourier coefficients</span>
<span class="n">nmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
<span class="n">pnmj</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">leg</span><span class="o">.</span><span class="n">fourier_coeffs</span><span class="p">(</span><span class="n">nmax</span><span class="p">)</span>


<span class="c1"># Compute the integral of a product of two spherical harmonics</span>
<span class="n">iy</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">integ</span><span class="o">.</span><span class="n">yi1n1m1yi2n2m2</span><span class="p">(</span><span class="n">cltmin</span><span class="p">,</span> <span class="n">cltmax</span><span class="p">,</span> <span class="n">lonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span>
                             <span class="n">i1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">pnmj</span><span class="p">)</span>


<span class="c1"># Print the value of the integral</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The integral of the product of two spherical harmonics &#39;</span>
      <span class="sa">f</span><span class="s1">&#39;i1 = </span><span class="si">{</span><span class="n">i1</span><span class="si">}</span><span class="s1">, n1 = </span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s1">, m1 = </span><span class="si">{</span><span class="n">m1</span><span class="si">}</span><span class="s1">, i2 = </span><span class="si">{</span><span class="n">i2</span><span class="si">}</span><span class="s1">, n2 = </span><span class="si">{</span><span class="n">n2</span><span class="si">}</span><span class="s1">, m2 = </span><span class="si">{</span><span class="n">m2</span><span class="si">}</span><span class="s1"> &#39;</span>
      <span class="sa">f</span><span class="s1">&#39;is </span><span class="si">{</span><span class="n">iy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="c1"># Now compute the integral of a product of two Legendre functions over</span>
<span class="c1"># a restricted domain</span>
<span class="n">ip</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">integ</span><span class="o">.</span><span class="n">pn1m1pn2m2</span><span class="p">(</span><span class="n">cltmin</span><span class="p">,</span> <span class="n">cltmax</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">pnmj</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The integral of the product of two Legendre functions &#39;</span>
      <span class="sa">f</span><span class="s1">&#39;n1 = </span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s1">, m1 = </span><span class="si">{</span><span class="n">m1</span><span class="si">}</span><span class="s1">, n2 = </span><span class="si">{</span><span class="n">n2</span><span class="si">}</span><span class="s1">, m2 = </span><span class="si">{</span><span class="n">m2</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="pyharm-in-single-precision">
<span id="id1"></span><h2>PyHarm in single precision<a class="headerlink" href="#pyharm-in-single-precision" title="Link to this heading">#</a></h2>
<p>A few simple rules need to be obeyed when working with PyHarm in single
precision.</p>
<ul>
<li><p>Make sure you have compiled the library in single precision (see
<a class="reference internal" href="install.html#installing"><span class="std std-ref">Installing</span></a>).</p></li>
<li><p>In Python, import the PyHarm package as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyharmf</span> <span class="k">as</span> <span class="nn">phf</span>
</pre></div>
</div>
</li>
<li><p>All floating point constants must be of the <code class="docutils literal notranslate"><span class="pre">numpy.float32</span></code> data type.  For
instance, while in double precision you can write this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyharm</span> <span class="k">as</span> <span class="nn">ph</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shcs</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">shc</span><span class="o">.</span><span class="n">Shc</span><span class="o">.</span><span class="n">from_zeros</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>in single precision, you have to write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyharmf</span> <span class="k">as</span> <span class="nn">phf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shcs</span> <span class="o">=</span> <span class="n">phf</span><span class="o">.</span><span class="n">shc</span><span class="o">.</span><span class="n">Shc</span><span class="o">.</span><span class="n">from_zeros</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>All floating point numpy arrays must be of the <code class="docutils literal notranslate"><span class="pre">numpy.float32</span></code> data type.
So when creating a numpy array to be passed to PyHarm, you must set the
<code class="docutils literal notranslate"><span class="pre">dtype</span></code> flag to <code class="docutils literal notranslate"><span class="pre">numpy.float32</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyharmf</span> <span class="k">as</span> <span class="nn">phf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">phf</span><span class="o">.</span><span class="n">crd</span><span class="o">.</span><span class="n">PointSctr</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="cookbook-c.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">CHarm</p>
      </div>
    </a>
    <a class="right-next"
       href="api.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Interfaces</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pyharm-in-double-precision">PyHarm in double precision</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integration-with-numpy">Integration with NumPy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-spherical-harmonic-coefficients">Working with spherical harmonic coefficients</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spherical-harmonic-synthesis-and-analysis">Spherical harmonic synthesis and analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#first-and-second-order-gradients-gravitational-vector-and-tensor">First- and second-order gradients (gravitational vector and tensor)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gravity-forward-modelling">Gravity forward modelling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fourier-coefficients-of-legendre-functions">Fourier coefficients of Legendre functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integrals">Integrals</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pyharm-in-single-precision">PyHarm in single precision</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By BlaÅ¾ej Bucha
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2025, BlaÅ¾ej Bucha.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on Mar 17, 2025.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>